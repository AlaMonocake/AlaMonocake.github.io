<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holy Grail War Simulator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 class="title">HOLY GRAIL WAR SIMULATOR</h1>
        <h2 id="day-counter">Day 1</h2>
    </header>
    
    <main>
        
        <div id="event-log" class="event-container">
            <!-- Events will be inserted here by JavaScript -->
        </div>
        
        <button class="button" id="next-day">Proceed to Next Day</button>
    </main>
     <!-- The script to collect participants follows -->
     <script>
        function loadParticipants() {
            console.log("Running loadParticipants()");
            const rawData = localStorage.getItem("participants");
            console.log("Loaded raw data:", rawData);

            if (!rawData) {
                console.error("No participants found in localStorage.");
                document.getElementById("event-log").innerHTML = "<p>No participants found. Please start from the index page.</p>";
                return [];
            }

            try {
                const participants = JSON.parse(rawData);
                console.log("Parsed participants:", participants);
                return participants;
            } catch (e) {
                console.error("Error parsing participants:", e);
                document.getElementById("event-log").innerHTML = "<p>Error loading participants data.</p>";
                return [];
            }
        }

        function generateDayOneEvents(participants) {
            const eventLog = document.getElementById("event-log");
            let events = `<h2>Day 1: Summoning</h2>`;

            const masters = participants.filter(p => p.type === "master");

            masters.forEach(master => {
                const servantName = master.servantName || "Unknown Servant";
                events += `
                    <p>
                        <img src="${master.picture}" width="50" style="vertical-align:middle;">
                        <strong>${master.name}</strong> summons <strong>${servantName}</strong>.
                    </p>
                `;
            });

            eventLog.innerHTML = events;
        }

        document.addEventListener("DOMContentLoaded", () => {
            console.log("Simulation page loaded");
            const participants = loadParticipants();

            if (participants.length > 0) {
                generateDayOneEvents(participants);
            }
        });
    </script>
</body>
</html>
